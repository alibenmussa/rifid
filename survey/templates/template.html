{% extends "base.html" %}
{% load django_tables2 %}
{% load crispy_forms_filters %}
{% load crispy_forms_tags %}
{% load crispy_forms_field %}
{% load static %}

{% block styles %}
    <style>
        #template-fields .template-field {
        {#transition: all 0.2s ease-in-out;#} transition: all 0.2s ease-in-out;

        }

        #template-fields .template-field .template-field-action-up, #template-fields .template-field .template-field-action-down {
            cursor: pointer;
            line-height: 0.7em;

        }

        #template-fields .template-field .template-field-action-up:hover, #template-fields .template-field .template-field-action-down:hover {
            color: var(--primary-color) !important;
        }


    </style>
{% endblock %}

{% block body %}

    <div class="row">
        <div class="col-12">
            <div class="mt-2">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <form method="post">
                                {% if form and form.helper %}
                                    {% crispy form form.helper %}
                                {% endif %}
                                <button type="submit" class="btn btn-primary mt-3 btn-block">إضافة الحقل</button>
                            </form>

                        </div>
                    </div>
                </div>

                {% if True %}

                    <div>
                        <ol class="list-unstyled" id="template-fields">
                            {% for field in fields %}
                                <li class="template-field py-3 mt-0 border-0" id="{{ field.1.name }}">
                                    <div class="card mb-0">
                                        <div class="card-body">

                                            <div class="d-flex justify-content-between align-items-center rounded-3 py-1 px-2 mb-4 bg-primary-transparent">

                                                <div class="d-flex">
                                                    <div class="d-flex flex-column justify-content-center">
                                                        <i class="bi bi-chevron-up text-muted fs-6 template-field-action-up"></i>
                                                        <i class="bi bi-chevron-down text-muted fs-6 template-field-action-down"></i>
                                                    </div>
                                                    <div class="d-flex justify-content-between align-items-center flex-grow-1 ms-2">
                                                        <span class="text-primary pe-1" style="opacity: 0.25;">#</span>
                                                        <h4 dir="ltr"
                                                            class="fw-normal mb-0 text-primary template-field-order">{{ forloop.counter }}</h4>
                                                        <p class="text-muted ms-2 mb-0"><i class="mx-2">
                                                            -
                                                        </i>    {{ field.0.get_type_display }}</p>
                                                        {{ field.1.is_required }}
                                                    </div>
                                                </div>

                                                <div class="d-flex">
                                                    {% if field.0.type != "form" %}
                                                        <a href="{% url 'dashboard:template_field_edit' template.id field.1.name %}">
                                                            <button class="btn btn-sm btn-outline-primary me-2">
                                                                <i class="bi bi-pencil-square"></i>
                                                            </button>
                                                        </a>
                                                    {% endif %}
                                                    <button class="btn btn-sm btn-outline-danger"
                                                            onclick="removeField('{{ field.1.name }}')">
                                                        <i class="bi bi-x"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="px-5">
                                                {% if field.0.type == "form" %}
                                                    <p>عدد الحقول: {{ field.0.sub_form.fields.count }}</p>
                                                    <table class="table table-light table-striped table-bordered">
                                                        <thead>
                                                        <!-- equal size columns -->
                                                        <tr>
                                                            {% for sub_field in field.0.sub_form.fields.all %}
                                                                <td class="text-center text-muted fw-bold" colspan="1">
                                                                    {{ sub_field.name }}</td>
                                                            {% endfor %}
                                                        </tr>

                                                        </thead>
                                                    </table>
                                                    <a href="{% url 'dashboard:template_detail' field.0.sub_form.id %}"
                                                       class="btn btn-lg btn-block btn-outline-primary mt-4">
                                                        تعديل نموذج {{ field.1.label }}
                                                    </a>

                                                {% else %}
                                                    {{ field.1|as_crispy_field }}

                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>


                                    {##}
                                    {#                                        <hr>#}
                                    {#                                            <div class="d-flex justify-content-between align-items-center rounded-3 py-1 px-2 mb-4 bg-primary-transparent">#}
                                    {##}
                                    {#                                                <div class="d-flex align-items-center">#}
                                    {#                                                    <div class="d-flex">#}
                                    {#                                                        <div class="d-flex flex-column justify-content-center">#}
                                    {#                                                            <i class="fa fa-chevron-up text-muted template-field-action-up mb-1"></i>#}
                                    {#                                                            <i class="fa fa-chevron-down text-muted template-field-action-down mt-1"></i>#}
                                    {#                                                        </div>#}
                                    {#                                                        <div class="d-flex justify-content-between align-items-center flex-grow-1 ms-3 me-2">#}
                                    {#                                                            <span class="text-primary pr-1"#}
                                    {#                                                                  style="opacity: 0.25;">#</span>#}
                                    {#                                                            <h5 class="fw-normal mb-0 text-primary template-field-order">{{ forloop.counter }}</h5>#}
                                    {#                                                        </div>#}
                                    {#                                                    </div>#}
                                    {#                                                    <h5 class="d-inline mb-0 ms-2 pl-3 border-left text-dark"#}
                                    {#                                                        style="border-left-width: 5pt">#}
                                    {#                                                        {{ field.1.label }}#}
                                    {#                                                        {% if field.1.field.required %}#}
                                    {#                                                            <span class="asteriskField text-primary">*</span>#}
                                    {#                                                        {% endif %}#}
                                    {#                                                    </h5>#}
                                    {#                                                    <small class="d-inline mx-3 mt-1 pl-3 border-left text-muted"#}
                                    {#                                                           style="flex-grow: 1; white-space:nowrap; flex-wrap: wrap !important;"#}
                                    {#                                                           style="border-left-width: 5pt">#}
                                    {#                                                        {{ field.0.get_type_display }} -#}
                                    {#                                                        {{ field.1.name }}#}
                                    {#                                                    </small>#}
                                    {#                                                </div>#}
                                    {##}
                                    {#                                                <div class="d-flex align-items-center">#}
                                    {##}
                                    {#                                                    <a href="{% url 'template_field_edit' template.id field.1.name %}">#}
                                    {#                                                        <button class="btn btn-sm btn-outline-primary me-2">#}
                                    {#                                                            <i class="bi bi-pencil-square"></i>#}
                                    {#                                                        </button>#}
                                    {#                                                    </a>#}
                                    {#                                                    <button class="btn align-middle btn-sm btn-outline-danger"#}
                                    {#                                                            onclick="removeField('{{ field.1.name }}')">#}
                                    {#                                                        <i class="fa fa-x"></i>#}
                                    {#                                                    </button>#}
                                    {#                                                </div>#}
                                    {##}
                                    {##}
                                    {#                                            </div>#}
                                    {##}
                                    {#                                            <div class="mt-4">#}
                                    {#                                                {{ field.1|as_crispy_field }}#}
                                    {##}
                                    {#                                            </div>#}
                                </li>
                            {% endfor %}
                        </ol>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

{% endblock body %}

{% block scripts %}
    {% include 'widgets/choices.html' %}


{% endblock scripts %}