{% load static %}

{% if distributions %}
<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>المستخدم</th>
                <th>الطالب</th>
                <th>تاريخ الإرسال</th>
                <th>الحالة</th>
                <th>تاريخ الإكمال</th>
            </tr>
        </thead>
        <tbody>
            {% for dist in distributions %}
            <tr>
                <td>
                    <div>{{ dist.user.get_full_name }}</div>
                    <small class="text-muted">{{ dist.user.username }}</small>
                </td>
                <td>
                    {% if dist.student %}
                        <div>{{ dist.student.first_name }} {{ dist.student.last_name }}</div>
                        <small class="text-muted">{{ dist.student.school_class.name }}</small>
                    {% else %}
                        <span class="text-muted">—</span>
                    {% endif %}
                </td>
                <td>{{ dist.sent_at|date:"Y-m-d H:i" }}</td>
                <td>
                    {% if dist.is_completed %}
                        <span class="badge bg-success"><i class="bi bi-check-circle"></i> مكتمل</span>
                    {% elif dist.is_expired %}
                        <span class="badge bg-danger"><i class="bi bi-x-circle"></i> منتهي</span>
                    {% else %}
                        <span class="badge bg-warning"><i class="bi bi-clock"></i> معلق</span>
                    {% endif %}
                </td>
                <td>
                    {% if dist.completed_at %}
                        {{ dist.completed_at|date:"Y-m-d H:i" }}
                    {% else %}
                        <span class="text-muted">—</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info text-center">
    <i class="bi bi-info-circle me-2"></i>
    لا توجد توزيعات في هذه الفئة
</div>
{% endif %}
