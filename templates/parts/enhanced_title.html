<!-- templates/parts/enhanced_title.html -->
<div class="row align-items-center">
    <div class="col-lg-8">
        <div class="page-title-content">
            <!-- Back Button -->
            {% if bar.back %}
            <div class="mb-2">
                <a href="{{ bar.back }}" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-arrow-right me-1"></i>
                    رجوع
                </a>
            </div>
            {% elif not bar.main %}
            <div class="mb-2">
                <button onclick="window.history.back()" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-arrow-right me-1"></i>
                    رجوع
                </button>
            </div>
            {% endif %}

            <!-- Title and Subtitle -->
            <div class="title-section">
                <h1 class="page-title">
                    {% if bar.icon %}
                    <i class="{{ bar.icon }} me-2"></i>
                    {% endif %}
                    {{ bar.title|default:"الصفحة الرئيسية" }}
                </h1>

                {% if bar.subtitle %}
                <p class="page-subtitle mb-2">{{ bar.subtitle }}</p>
                {% endif %}

                <!-- Breadcrumb -->
                {% if bar.breadcrumb %}
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="{% url 'dashboard:dashboard' %}">
                                <i class="bi bi-house-door"></i>
                                الرئيسية
                            </a>
                        </li>
                        {% for item in bar.breadcrumb %}
                        <li class="breadcrumb-item">
                            {% if item.link %}
                                <a href="{{ item.link }}">{{ item.text }}</a>
                            {% else %}
                                {{ item.text }}
                            {% endif %}
                        </li>
                        {% endfor %}
                        <li class="breadcrumb-item active" aria-current="page">
                            {{ bar.title }}
                        </li>
                    </ol>
                </nav>
                {% endif %}

                <!-- Count Information -->
                {% if bar.count %}
                <div class="count-info mt-2">
                    <span class="badge bg-light text-dark fs-6">
                        <i class="bi bi-list-ul me-1"></i>
                        {% if request.GET and request.GET|length > 1 or not request.GET.page %}
                            {% if request.GET|length > 1 or not request.GET.page %}
                            <span class="text-primary">نتائج البحث:</span>
                            {% endif %}
                        {% endif %}
                        {{ bar.count.total|floatformat:0 }} {{ bar.count.label|default:"عنصر" }}
                    </span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    {% if bar.buttons %}
    <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
        <div class="btn-group-actions d-flex flex-wrap gap-2 justify-content-lg-end">
            {% for button in bar.buttons %}
                {% if button %}
                <a href="{{ button.url|default:'#' }}"
                   class="btn {{ button.color|default:'btn-primary' }}"
                   {% if button.target %}target="{{ button.target }}"{% endif %}
                   {% if button.onclick %}onclick="{{ button.onclick }}"{% endif %}
                   {% if button.title %}title="{{ button.title }}"{% endif %}>
                    {% if button.icon %}
                    <i class="{{ button.icon }} me-1"></i>
                    {% endif %}
                    {{ button.label|default:"إجراء" }}
                </a>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<!-- Additional Info Bar -->
{% if bar.info_cards %}
<div class="row mt-3">
    {% for card in bar.info_cards %}
    <div class="col-md-3">
        <div class="stats-card text-center">
            <div class="stats-icon {{ card.color|default:'blue' }} mx-auto">
                <i class="{{ card.icon|default:'bi bi-info-circle' }}"></i>
            </div>
            <h4 class="mb-1">{{ card.value|default:"0" }}</h4>
            <p class="text-muted mb-0">{{ card.label }}</p>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Quick Filters or Tabs -->
{% if bar.tabs %}
<div class="mt-3">
    <ul class="nav nav-pills nav-justified bg-light rounded p-1">
        {% for tab in bar.tabs %}
        <li class="nav-item">
            <a class="nav-link {% if tab.active %}active{% endif %}"
               href="{{ tab.url|default:'#' }}">
                {% if tab.icon %}
                <i class="{{ tab.icon }} me-1"></i>
                {% endif %}
                {{ tab.label }}
                {% if tab.count %}
                <span class="badge bg-secondary ms-1">{{ tab.count }}</span>
                {% endif %}
            </a>
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}
